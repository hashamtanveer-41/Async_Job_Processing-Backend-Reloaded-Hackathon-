class RateLimiter {
  static {
    // Config: Max 2 jobs per 60 seconds
    this.LIMIT = 2;
  }
  static {
    this.WINDOW_MS = 60 * 1e3;
  }
  static async check(userId, state) {
    const key = `rate-limit:${userId}`;
    const now = Date.now();
    const current = await state.get("rate-limits", key);
    if (!current || now - current.windowStart > this.WINDOW_MS) {
      await state.set("rate-limits", key, {
        count: 1,
        windowStart: now
      });
      return { allowed: true, remaining: this.LIMIT - 1 };
    }
    if (current.count >= this.LIMIT) {
      return { allowed: false, remaining: 0 };
    }
    await state.set("rate-limits", key, {
      ...current,
      count: current.count + 1
    });
    return { allowed: true, remaining: this.LIMIT - (current.count + 1) };
  }
}
export {
  RateLimiter
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vdXRpbHMvcmF0ZS1saW1pdGVyLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGSUxFOiBzcmMvdXRpbHMvcmF0ZS1saW1pdGVyLnRzXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFN0YXRlIHtcclxuICBjb3VudDogbnVtYmVyO1xyXG4gIHdpbmRvd1N0YXJ0OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBSYXRlTGltaXRlciB7XHJcbiAgLy8gQ29uZmlnOiBNYXggMiBqb2JzIHBlciA2MCBzZWNvbmRzXHJcbiAgc3RhdGljIHJlYWRvbmx5IExJTUlUID0gMjtcclxuICBzdGF0aWMgcmVhZG9ubHkgV0lORE9XX01TID0gNjAgKiAxMDAwOyBcclxuXHJcbiAgc3RhdGljIGFzeW5jIGNoZWNrKFxyXG4gICAgdXNlcklkOiBzdHJpbmcsIFxyXG4gICAgc3RhdGU6IGFueVxyXG4gICk6IFByb21pc2U8eyBhbGxvd2VkOiBib29sZWFuOyByZW1haW5pbmc/OiBudW1iZXIgfT4ge1xyXG4gICAgXHJcbiAgICBjb25zdCBrZXkgPSBgcmF0ZS1saW1pdDoke3VzZXJJZH1gO1xyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICAvLyAxLiBHZXQgY3VycmVudCB1c2FnZSBmcm9tIFN0YXRlXHJcbiAgICBjb25zdCBjdXJyZW50ID0gKGF3YWl0IHN0YXRlLmdldCgncmF0ZS1saW1pdHMnLCBrZXkpKSBhcyBSYXRlTGltaXRTdGF0ZSB8IG51bGw7XHJcblxyXG4gICAgLy8gMi4gSWYgbm8gcmVjb3JkLCBvciB3aW5kb3cgaGFzIGV4cGlyZWQgLT4gUmVzZXRcclxuICAgIGlmICghY3VycmVudCB8fCAobm93IC0gY3VycmVudC53aW5kb3dTdGFydCA+IHRoaXMuV0lORE9XX01TKSkge1xyXG4gICAgICBhd2FpdCBzdGF0ZS5zZXQoJ3JhdGUtbGltaXRzJywga2V5LCB7XHJcbiAgICAgICAgY291bnQ6IDEsXHJcbiAgICAgICAgd2luZG93U3RhcnQ6IG5vd1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcmVtYWluaW5nOiB0aGlzLkxJTUlUIC0gMSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDMuIElmIHdpdGhpbiB3aW5kb3csIGNoZWNrIGxpbWl0XHJcbiAgICBpZiAoY3VycmVudC5jb3VudCA+PSB0aGlzLkxJTUlUKSB7XHJcbiAgICAgIHJldHVybiB7IGFsbG93ZWQ6IGZhbHNlLCByZW1haW5pbmc6IDAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA0LiBJbmNyZW1lbnQgY291bnRcclxuICAgIGF3YWl0IHN0YXRlLnNldCgncmF0ZS1saW1pdHMnLCBrZXksIHtcclxuICAgICAgLi4uY3VycmVudCxcclxuICAgICAgY291bnQ6IGN1cnJlbnQuY291bnQgKyAxXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4geyBhbGxvd2VkOiB0cnVlLCByZW1haW5pbmc6IHRoaXMuTElNSVQgLSAoY3VycmVudC5jb3VudCArIDEpIH07XHJcbiAgfVxyXG59Il0sCiAgIm1hcHBpbmdzIjogIkFBU08sTUFBTSxZQUFZO0FBQUEsRUFFdkI7QUFBQTtBQUFBLFNBQWdCLFFBQVE7QUFBQTtBQUFBLEVBQ3hCO0FBQUEsU0FBZ0IsWUFBWSxLQUFLO0FBQUE7QUFBQSxFQUVqQyxhQUFhLE1BQ1gsUUFDQSxPQUNtRDtBQUVuRCxVQUFNLE1BQU0sY0FBYyxNQUFNO0FBQ2hDLFVBQU0sTUFBTSxLQUFLLElBQUk7QUFHckIsVUFBTSxVQUFXLE1BQU0sTUFBTSxJQUFJLGVBQWUsR0FBRztBQUduRCxRQUFJLENBQUMsV0FBWSxNQUFNLFFBQVEsY0FBYyxLQUFLLFdBQVk7QUFDNUQsWUFBTSxNQUFNLElBQUksZUFBZSxLQUFLO0FBQUEsUUFDbEMsT0FBTztBQUFBLFFBQ1AsYUFBYTtBQUFBLE1BQ2YsQ0FBQztBQUNELGFBQU8sRUFBRSxTQUFTLE1BQU0sV0FBVyxLQUFLLFFBQVEsRUFBRTtBQUFBLElBQ3BEO0FBR0EsUUFBSSxRQUFRLFNBQVMsS0FBSyxPQUFPO0FBQy9CLGFBQU8sRUFBRSxTQUFTLE9BQU8sV0FBVyxFQUFFO0FBQUEsSUFDeEM7QUFHQSxVQUFNLE1BQU0sSUFBSSxlQUFlLEtBQUs7QUFBQSxNQUNsQyxHQUFHO0FBQUEsTUFDSCxPQUFPLFFBQVEsUUFBUTtBQUFBLElBQ3pCLENBQUM7QUFFRCxXQUFPLEVBQUUsU0FBUyxNQUFNLFdBQVcsS0FBSyxTQUFTLFFBQVEsUUFBUSxHQUFHO0FBQUEsRUFDdEU7QUFDRjsiLAogICJuYW1lcyI6IFtdCn0K
